# ğŸš€ yuangs CLI - An AIâ€‘Augmented Shell

**ä»¥äººç±»æ„å›¾ä¸ºä¸­å¿ƒçš„ AIâ€‘Augmented Shell**

> A seamless terminal where deterministic execution and probabilistic intelligence coexist without friction.

ä¸€ä¸ªé›† **AI åŠ©æ‰‹ Â· æ™ºèƒ½ Shell å†…æ ¸ Â· æ’ä»¶åŒ–è¿è¡Œæ—¶** äºä¸€ä½“çš„ç°ä»£ç»ˆç«¯å·¥å…·ã€‚

> **æ ¸å¿ƒç†å¿µ**  
> **AI æä¾›æ€è·¯ï¼Œäººç±»æŒæ§æ‰§è¡Œã€‚**  
> yuangs è‡´åŠ›äºåœ¨ä¸ç ´åä¼ ç»Ÿ Shell å¿ƒæ™ºæ¨¡å‹çš„å‰æä¸‹ï¼Œå¼•å…¥ AI çš„é€»è¾‘èƒ½åŠ›ã€‚  
> å®ƒä¸æ˜¯é»‘ç›’æ‰§è¡Œå™¨ï¼Œè€Œæ˜¯ä½ çš„ **å¢å¼ºå‹å‘½ä»¤è¡Œå¤–è„‘**ã€‚

---

# yuangs

> **ä¸ºç»ˆç«¯è€Œç”Ÿçš„ AI æ²»ç†è¿è¡Œæ—¶**  
> *ä¸ OOMï¼Œä¸æƒŠå–œï¼Œå§‹ç»ˆæœ‰äººç±»åœ¨ç¯*

`yuangs` æ˜¯ä¸€ä¸ªéµå¾ª Unix å“²å­¦çš„ AI å·¥å…·ï¼ŒçŒ®ç»™é‚£äº›é•¿æœŸå·¥ä½œåœ¨ç»ˆç«¯é‡Œã€**æ‹’ç»é»‘ç›’é­”æ³•**çš„å¼€å‘è€…ã€‚

å®ƒä¸æ˜¯æµè§ˆå™¨æ’ä»¶ã€‚  
ä¸æ˜¯ GUI åŠ©æ‰‹ã€‚  
ä¹Ÿä¸æ˜¯"æŠ«ç€ CLI å¤–è¡£çš„èŠå¤©æœºå™¨äºº"ã€‚

å®ƒè§£å†³çš„æ˜¯ä¸€ä¸ªæ›´éš¾çš„é—®é¢˜ï¼š

> **å½“ä¸å¯æ§çš„ AI è¿›å…¥æç«¯å¼ºè°ƒå¯æ§æ€§çš„ç»ˆç«¯ï¼Œç§©åºè¯¥å¦‚ä½•é‡å»ºï¼Ÿ**

---

## è®¾è®¡å“²å­¦

### ğŸ§© åšå¥½ä¸€ä»¶äº‹ï¼ˆDo one thing and do it wellï¼‰

`yuangs` çš„å®šä½ä¸æ˜¯"å…¨èƒ½åŠ©æ‰‹"ï¼Œè€Œæ˜¯ä¸€ä¸ª**ä¸Šä¸‹æ–‡æ²»ç†å™¨ï¼ˆContext Governorï¼‰**ã€‚

ä½ å§‹ç»ˆæ¸…æ¥šã€å¹¶ä¸”æ˜¾å¼åœ°å†³å®šï¼š
- å“ªäº›æ–‡ä»¶è¿›å…¥ AI ä¸Šä¸‹æ–‡
- Token é¢„ç®—æ˜¯å¤šå°‘
- ä½•æ—¶é‡‡æ ·ã€ä½•æ—¶ç¡®è®¤
- ä»€ä¹ˆæ—¶å€™å…è®¸æ‰§è¡Œ


æ–‡ä»¶ç³»ç»Ÿä¸ AI é€»è¾‘é€šè¿‡**è¯­æ³•**è€Œä¸æ˜¯ç‚¹å‡»è¿æ¥ï¼š

```bash
ai "@src/**/*.ts #docs"
```

è¿™ä¸æ˜¯æŠ€å·§ï¼Œè¿™æ˜¯ Unix å“²å­¦ï¼š
**è¯­æ³•å³åŠ›é‡ï¼ˆPower of Syntaxï¼‰**ã€‚

---

### ğŸ›¡ï¸ å¼€å‘è€…ä¸»æƒï¼Œè€Œä¸æ˜¯"æ–¹ä¾¿è‡³ä¸Š"

å¾ˆå¤šç»ˆç«¯ AI å·¥å…·è¿½æ±‚"çœäº‹"ï¼Œä»£ä»·å´æ˜¯**ä¸é€æ˜**ï¼š
- æ•°æ®æ‚„æ‚„ä¸Šä¼ 
- ä¸Šä¸‹æ–‡è¢«éšå¼æˆªæ–­
- æ‰§è¡Œé€»è¾‘ä¸å¯å®¡è®¡

`yuangs` é€‰æ‹©äº†å¦ä¸€æ¡è·¯ï¼š
- âœ… **Swissâ€‘Cheese é‡‡æ ·é¢„è§ˆ**ï¼šå‘é€å‰çœ‹åˆ°"æ¯ä¸€å—å¥¶é…ª"
- âœ… **TokenPolicy**ï¼šå…ˆä¼°ç®—ã€å†ç¡®è®¤
- âœ… **Humanâ€‘inâ€‘theâ€‘loop**ï¼šåˆ‡æ¨¡å‹ã€å‘è¯·æ±‚ã€è·‘æ‰§è¡Œï¼Œæ°¸è¿œéœ€è¦ä½ ç‚¹å¤´

ä½ çš„ç»ˆç«¯ï¼Œ
ä½ çš„æ•°æ®ï¼Œ
ä½ çš„å†³å®šã€‚

è¿™æ‰æ˜¯æå®¢çœ¼ä¸­çš„**çœŸè‡ªç”±**ã€‚

---

### ğŸ§  å¯ç¼–ç¨‹çš„ Agent åŸºç¡€è®¾æ–½ï¼Œè€Œä¸æ˜¯ Prompt Wrapper

`yuangs` å‘å¸ƒåˆ° npm çš„ä¸æ˜¯ä¸€ä¸ª"å‘½ä»¤"ï¼Œ
è€Œæ˜¯ä¸€å¥—**å¯ç»„åˆçš„ Agent è¿è¡Œæ—¶**ã€‚

æ ¸å¿ƒæŠ½è±¡åŒ…æ‹¬ï¼š
- `PendingContextItem`
- ä¸Šä¸‹æ–‡ä¼°ç®— / è§£æåˆ†ç¦»
- èƒ½åŠ›æ„ŸçŸ¥çš„æ‰§è¡Œç­–ç•¥
- å¯å›æ”¾ã€å¯å®¡è®¡çš„æ‰§è¡Œè®°å½•

ä½ æ‹¿åˆ°çš„ä¸æ˜¯é»‘ç›’ï¼Œ
è€Œæ˜¯ä¸€ç›’**å¸¦è¯´æ˜ä¹¦çš„ä¹é«˜**ã€‚

ä½ å¯ä»¥ç”¨å®ƒæ„å»ºï¼š
- ä»“åº“ç»“æ„åˆ†æå™¨
- æ—¥å¿— â†’ AI çš„è‡ªåŠ¨é‡‡é›†ç®¡é“
- å¯æ§çš„é‡æ„ Agent
- å¯å®¡è®¡çš„è‡ªåŠ¨åŒ–æµç¨‹

---

## æ ¸å¿ƒç‰¹æ€§ä¸€è§ˆ

âœ… **No OOM, No Surprise**  
å†å¤§çš„ä»“åº“ã€å†é•¿çš„æ—¥å¿—ï¼Œæ²¡æœ‰ç¡®è®¤å°±ä¸ä¼šåƒå†…å­˜ã€ä¸ä¼šå‘é€ã€‚

âœ… **Humanâ€‘inâ€‘theâ€‘loop, Always**  
ç³»ç»Ÿæ°¸è¿œä¸ä¼šæ›¿ä½ åšé»‘ç›’å†³ç­–ã€‚

âœ… **Power of Syntax**  
`@file`ã€`#dir`ã€æ„å›¾è¯­æ³•ï¼Œæ¯”æ‹–æ‹½æ–‡ä»¶æ›´å¿«ã€æ›´é…·ã€‚

âœ… **å¯å›æ”¾ã€å¯å®¡è®¡**  
æ¯ä¸€æ¬¡ AI è¡Œä¸ºéƒ½èƒ½å¤ç›˜ã€å¤ç°ã€è°ƒè¯•ã€‚

âœ… **å¯è§£é‡Šã€å¯æ²»ç†**  
é€šè¿‡ `explain` å’Œ `replay` å‘½ä»¤ï¼Œç†è§£ç³»ç»Ÿå†³ç­–è¿‡ç¨‹ã€‚

---

## é€‚åˆè°ï¼Ÿ

- ç»ˆç«¯åŸæ•™æ—¨ä¸»ä¹‰è€…
- Linux / Unix å“²å­¦ä¿¡å¾’
- è¢«ä¸é€æ˜ AI å·¥å…·ä¼¤è¿‡çš„å·¥ç¨‹å¸ˆ
- è¿½æ±‚**ç¡®å®šæ€§é«˜äºä¾¿åˆ©æ€§**çš„äºº

å¦‚æœä½ è®¤åŒè¿™å¥è¯ï¼š

> **"AI å¾ˆå¼ºå¤§ï¼Œæ‰€ä»¥å®ƒå¿…é¡»è¢«æ²»ç†ã€‚"**

é‚£ `yuangs` å°±æ˜¯ä¸ºä½ å†™çš„ã€‚

---

## ğŸ“œ è¯­æ³•è¯´æ˜

yuangs é€šè¿‡ä¸€å¥—**æ˜¾å¼çš„ç¬¦å·è¯­æ³•**ï¼Œæ¸…æ™°ç•Œå®š"å‰¯ä½œç”¨"çš„æ¥æºï¼Œ
ç¡®ä¿æ¯ä¸€æ¡å‘½ä»¤ **å¯ç†è§£ã€å¯ç¡®è®¤ã€å¯å®¡è®¡**ã€‚

| è¯­æ³• | è¡Œä¸ºé€»è¾‘ | å†³ç­–æ¥æº | é€‚ç”¨åœºæ™¯ |
| :--- | :--- | :--- | :--- |
| `ls -la` | ç›´æ¥è¿è¡Œå‘½ä»¤ï¼ˆfish-styleï¼‰ | ç”¨æˆ· | ä¼ ç»Ÿ Shell æ“ä½œ |
| `@path[:line]` | å¼•ç”¨æ–‡ä»¶ / è¡Œå·ä¸Šä¸‹æ–‡ | ç”¨æˆ· | ä»£ç å®¡è®¡ã€æŠ¥é”™åˆ†æ |
| `#dir` | æ‰¹é‡å¼•å…¥ç›®å½•ä¸Šä¸‹æ–‡ | ç”¨æˆ· | é¡¹ç›®ç»“æ„ç†è§£ |
| `ai "msg"` | çº¯è‡ªç„¶è¯­è¨€å¯¹è¯ | AI | æ–¹æ¡ˆè®¨è®ºã€çŸ¥è¯†æŸ¥è¯¢ |
| `ai -e` | ç”Ÿæˆ**å»ºè®®**å‘½ä»¤ | AI â†’ ç”¨æˆ· | å¤æ‚å‘½ä»¤è¾…åŠ© |
| `:exec` | ç»•è¿‡ AI çš„åŸå­æ‰§è¡Œ | ç”¨æˆ· | ç¡®å®šæ€§è„šæœ¬ |

---

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½ Shell å†…æ ¸ï¼ˆv2.10.0+ï¼‰

è¿›å…¥äº¤äº’å¼ AIâ€‘Augmented Shellï¼š

```bash
yuangs ai
```

ç‰¹æ€§åŒ…æ‹¬ï¼š

- **æ¨¡å¼è‡ªåŠ¨è·¯ç”±**
  æ— éœ€åˆ‡æ¢æ¨¡å¼ï¼š
  - è¾“å…¥ `git status` â†’ ç›´æ¥æ‰§è¡Œ
  - è¾“å…¥ã€Œè§£é‡Šè¿™æ®µä»£ç ã€â†’ è¿›å…¥å¯¹è¯

- **ğŸ‘» Ghost Textï¼ˆå¹½çµå»ºè®®ï¼‰**
  æ ¹æ®å†å²è®°å½•ä¸æ’ä»¶é¢„æµ‹è¾“å…¥
  ä¾‹å¦‚è¾“å…¥ `npm r`ï¼Œç°è‰²æ˜¾ç¤º `un dev`ï¼ŒæŒ‰ `Tab` é‡‡çº³

- **âš¡ è¡¥å…¨å¢å¼º**
  - **PATH æ‰«æ**ï¼šè‡ªåŠ¨è¡¥å…¨ 40+ å¸¸ç”¨ç³»ç»Ÿå‘½ä»¤
  - **ç²¾å‡†è¡Œå·**ï¼šæ”¯æŒ `@src/index.ts:10-50`
  - **é¡¹ç›®æ„ŸçŸ¥**ï¼šæå‡ `src/`ã€`packages/` ç­‰ç›®å½•æƒé‡

---

### 1.5 yuangs Zero-Mode (æç®€ Shell AI å¢å¼º)

å¦‚æœä½ ä¸æƒ³è¿›å…¥ä¸“é—¨çš„äº¤äº’æ¨¡å¼ï¼Œ`yuangs` æä¾›äº†ä¸€ä¸ª"é›¶ä¾µå…¥"çš„é›†æˆæ–¹æ¡ˆï¼Œè®©ä½ åœ¨åŸæœ¬çš„ Bash/Zsh ä¸­ä¿æŒå¿ƒæµï¼š

#### ğŸ“¦ å®‰è£…ä¸å¸è½½

```bash
# å®‰è£…
bash ./scripts/yuangs-install.sh

# å¸è½½
bash ./scripts/yuangs-install.sh --uninstall
```
å®‰è£…åè¯·æ‰§è¡Œ `source ~/.zshrc` (æˆ– `.bashrc`)ã€‚

#### ğŸš€ æ ¸å¿ƒç©æ³•

1. **`?? <é—®é¢˜>` (å³æ—¶å’¨è¯¢)**
   åœ¨ä»»ä½•æ—¶å€™ï¼Œåªéœ€è¾“å…¥ `??` åŠ ç©ºæ ¼ï¼Œå³å¯å‘ AI æé—®ã€‚
   ```bash
   ?? æ€ä¹ˆè§£å‹ä¸€ä¸ª .tar.gz æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•ï¼Ÿ
   ```

2. **å›è½¦å³æ•‘æ€¥ (Failed-Command Help)**
   å½“ä½ æ‰§è¡Œä¸€ä¸ªå‘½ä»¤å¤±è´¥æ—¶ï¼ˆä¾‹å¦‚ `git push` è¢«æ‹’ç»ï¼‰ï¼Œç»ˆç«¯ä¼šæç¤ºï¼š
   `â†³ Need help? Press Enter`
   æ­¤æ—¶**ç›´æ¥æŒ‰å›è½¦**ï¼ŒAI ä¼šé€šè¿‡ `yuangs` çš„ä¸Šä¸‹æ–‡æ²»ç†èƒ½åŠ›ï¼Œè‡ªåŠ¨åˆ†æé”™è¯¯åŸå› å¹¶ç»™å‡ºä¿®å¤æ–¹æ¡ˆã€‚

3. **å¼€å…³è‡ªå¦‚**
   - `ai_off`: ä¸´æ—¶ç¦ç”¨ AI è§¦å‘é€»è¾‘ã€‚
   - `ai_on`: é‡æ–°å¯ç”¨ AI å¢å¼ºã€‚

---

### 2. ç²¾å‡†ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆContextBufferï¼‰

#### ç®¡é“æ¨¡å¼ï¼ˆPipe Modeï¼‰

```bash
cat error.log | yuangs "è§£é‡Šè¿™ä¸ªæŠ¥é”™"
git diff | yuangs -w "Review å˜æ›´é€»è¾‘"
```

#### `-w` æ™ºèƒ½è¯»å–
- è‡ªåŠ¨è§£æç®¡é“ä¸­çš„æ–‡ä»¶è·¯å¾„
- åªè¯»å–**è¢«æ˜¾å¼å¼•ç”¨**çš„æ–‡ä»¶å†…å®¹
- ä¸è¿›è¡Œéšå¼æ–‡ä»¶ç³»ç»Ÿæ‰«æ

---

### 3. æ’ä»¶ç³»ç»Ÿï¼ˆPluginsï¼‰

åœ¨ `.shell/plugins/` ä¸‹æ”¾ç½®è‡ªå®šä¹‰è„šæœ¬ï¼Œ
æ‰©å±•ç‰¹å®šå·¥å…·çš„è¡¥å…¨ä¸æ¨ç†èƒ½åŠ›ï¼ˆå¦‚ `docker`ã€`kubectl`ï¼‰ã€‚

ç¤ºä¾‹ï¼š

```ts
// .shell/plugins/docker.ts
module.exports = {
  command: 'docker',
  complete(args) {
    return ['ps', 'run', 'build', 'exec'];
  }
};
```

---

## ğŸ”’ Phase 2: Explainability & Governance (v1)

### ğŸ¯ æ¦‚è¿°

Phase 2 å¼•å…¥äº†**ç³»ç»Ÿå¯è§‚æµ‹æ€§å’Œæ§åˆ¶èƒ½åŠ›**ï¼Œä½†ä¸æ”¹å˜æ ¸å¿ƒè¡Œä¸ºï¼š
- âœ… **Explainability**ï¼šäººç±»å¯è¯»çš„æ‰§è¡Œè§£é‡Š
- âœ… **Replay++**ï¼šDry-runã€explain å’Œ diff èƒ½åŠ›
- âœ… **Skill Control**ï¼šå¯ç”¨/ç¦ç”¨æŠ€èƒ½ä»¥å®ç°ç»†ç²’åº¦æ§åˆ¶

---

## ğŸ“¦ æ–°å‘½ä»¤

### `yuangs explain [id | last]`

**ç›®çš„**ï¼šè§£é‡Šç³»ç»Ÿä¸ºä»€ä¹ˆåšå‡ºæŸä¸ªå†³ç­–

**ç”¨æ³•**ï¼š
```bash
# è§£é‡Šæœ€è¿‘ä¸€æ¬¡æ‰§è¡Œ
yuangs explain last

# è§£é‡ŠæŒ‡å®š ID çš„æ‰§è¡Œ
yuangs explain exec_1768820380225_rgts34981
```

**è¾“å‡ºæ ¼å¼ï¼ˆv1ï¼‰**ï¼š
```
=== Execution Explanation ===
[1] Command
- Name: ai-command
- Args: echo "hello"

[2] Decision
- Strategy: capability-match
- Selected Model: gemini-2.5-flash-lite
- Reason: Capability-based selection with fallback support

[3] Model
- Name: gemini-2.5-flash-lite
- Provider: aiproxy
- Context Window: 8000
- Cost Profile: low

[4] Skills
- (none)

[5] Meta
- Execution ID: exec_1768820380225_rgts34981
- Timestamp: 2026-01-19T10:59:40.225Z
- Replayable: true
- Version: unknown
=============================
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… çº¯åªè¯»æ“ä½œï¼ˆæ— å‰¯ä½œç”¨ï¼‰
- âœ… ç¨³å®šã€å¯ snapshot çš„è¾“å‡º
- âœ… ä¸ºæœªæ¥çš„ diff/audit å·¥ä½œæµåšå¥½çš„å‡†å¤‡

---

### `yuangs replay <id> [options]`

**ç›®çš„**ï¼šä½¿ç”¨æ§åˆ¶æ ‡å¿—é‡æ”¾æ‰§è¡Œ

**é€‰é¡¹**ï¼š
| é€‰é¡¹ | æè¿° |
|--------|-------------|
| `-s, --strict` | ä¸¥æ ¼é‡æ”¾ï¼ˆä½¿ç”¨ç²¾ç¡®æ¨¡å‹ï¼‰ |
| `-c, --compatible` | å…¼å®¹é‡æ”¾ï¼ˆå…è®¸ fallbackï¼‰ |
| `-r, --re-evaluate` | ä½¿ç”¨å½“å‰é…ç½®é‡æ–°è¯„ä¼° |
| `-v, --verbose` | è¯¦ç»†è¾“å‡º |
| `--dry` | Dry run - æ˜¾ç¤ºå°†è¦å‘ç”Ÿçš„å†…å®¹ä½†ä¸æ‰§è¡Œ |
| `--explain` | åœ¨é‡æ”¾å‰æ˜¾ç¤ºè§£é‡Š |
| `--diff` | æ˜¾ç¤ºåŸå§‹é…ç½®ä¸å½“å‰é…ç½®çš„å·®å¼‚ |

**ç”¨æ³•ç¤ºä¾‹**ï¼š
```bash
# ä½¿ç”¨è§£é‡Šè¿›è¡Œ dry run
yuangs replay exec_1768820380225_rgts34981 --dry --explain

# ä»…æ˜¾ç¤º diffï¼ˆä¸æ‰§è¡Œï¼‰
yuangs replay exec_1768820380225_rgts34981 --diff --dry

# å¸¦å·®å¼‚çš„å®Œæ•´é‡æ”¾
yuangs replay exec_1768820380225_rgts34981 --diff
```

**é‡æ”¾è¡Œä¸ºçŸ©é˜µ**ï¼š
| explain | dry | strict | è¡Œä¸º |
|--------|-----|--------|----------|
| âœ… | âœ… | any | ä»…è§£é‡Šï¼Œä¸æ‰§è¡Œ |
| âœ… | âŒ | âœ… | è§£é‡Š â†’ é‡æ”¾ |
| âŒ | âœ… | âœ… | æ‰“å°ä¸¥æ ¼ä¿¡æ¯ â†’ é€€å‡º |
| âŒ | âŒ | âœ… | æ­£å¸¸é‡æ”¾ |

**å·®å¼‚è¾“å‡º**ï¼š
```
=== Replay Diff ===
[Decision]
- no change

[Model]
- no change

[Skills]
- no change
===================
```

---

### `yuangs skills <subcommand>`

**ç›®çš„**ï¼šç®¡ç†æŠ€èƒ½åº“

**å­å‘½ä»¤**ï¼š
```bash
# åˆ—å‡ºæ‰€æœ‰æŠ€èƒ½åŠå…¶åˆ†æ•°
yuangs skills list

# è§£é‡Šç‰¹å®šæŠ€èƒ½
yuangs skills explain <skill-name>

# ç¦ç”¨æŠ€èƒ½
yuangs skills disable <skill-name>

# å¯ç”¨æŠ€èƒ½
yuangs skills enable <skill-name>
```

**è¾“å‡ºç¤ºä¾‹**ï¼ˆ`skills list`ï¼‰ï¼š
```
ğŸ“¦ Skills (3)

âœ” deploy-production
  Confidence: 72%
  Success: 8 / Failure: 1
  Last used: 2 days ago

âœ” cleanup-logs
  Confidence: 41%
  Success: 5 / Failure: 7
  Last used: 1 day ago

âŠ˜ legacy-search (disabled)
  Confidence: 23%
  Success: 2 / Failure: 6
  Last used: 7 days ago
```

**å…³é”®ç‰¹æ€§**ï¼š
- âœ… æŠ€èƒ½å¯ä»¥è¢«ç¦ç”¨è€Œä¸åˆ é™¤
- âœ… æŠ€èƒ½æŒ‰ç›¸å…³æ€§è¯„åˆ†å’Œæ’åº
- âœ… ç¦ç”¨çš„æŠ€èƒ½ä¸å½±å“æ–°å†³ç­–
- âœ… æ‰€æœ‰æŠ€èƒ½åœ¨ `explain` è¾“å‡ºä¸­ä»ç„¶å¯è§

---

## ğŸ§­ Explain è¾“å‡ºè§„èŒƒ v1

explain è¾“å‡ºéµå¾ªä¸¥æ ¼æ ¼å¼ï¼Œè®¾è®¡ç”¨äºï¼š
- âœ… äººç±»å¯è¯»æ€§
- âœ… ç¨³å®šæ€§å’Œ snapshot å…¼å®¹æ€§
- âœ… æœªæ¥çš„ diff/audit å·¥ä½œæµ
- âœ… æ— å®ç°è€¦åˆ

**ç»“æ„**ï¼ˆ5 ä¸ªéƒ¨åˆ†ï¼Œä¸å¯å˜é¡ºåºï¼‰ï¼š
1. `[1] Command` - ç”¨æˆ·è¾“å…¥å±‚
2. `[2] Decision` - å†³ç­–æ ¸å¿ƒ
3. `[3] Model` - æ‰§è¡Œç¯å¢ƒ
4. `[4] Skills` - å½±å“å†³ç­–çš„æŠ€èƒ½
5. `[5] Meta` - å®¡è®¡/é‡æ”¾å…ƒæ•°æ®

**é‡è¦æç¤º**ï¼š
- âš ï¸ ä¸è¦åœ¨å‡çº§è§„èŒƒç‰ˆæœ¬æ—¶æ›´æ”¹æ ¼å¼
- âœ… è¾“å‡ºæ˜¯çº¯æ–‡æœ¬ï¼ˆsnapshot æ— é¢œè‰²ï¼‰
- âœ… ç›¸åŒæ‰§è¡Œè®°å½• = 100% å¯é‡ç°è¾“å‡º

---

## ğŸ”’ æŠ€èƒ½ä¸å¯ç”¨çŠ¶æ€

æŠ€èƒ½ç°åœ¨æœ‰ä¸€ä¸ª `enabled` å­—æ®µï¼Œæ§åˆ¶å®ƒä»¬åœ¨æ–°å†³ç­–ä¸­çš„å‚ä¸ï¼š

**é»˜è®¤è¡Œä¸º**ï¼š
- âœ… æ–°æŠ€èƒ½ï¼š`enabled: true`
- âœ… æ—§æŠ€èƒ½ï¼š`enabled: true`ï¼ˆå¦‚æœå­—æ®µç¼ºå¤±ï¼‰
- âŒ ç¦ç”¨çš„æŠ€èƒ½ï¼šä¸åŒ…å«åœ¨ `getRelevantSkills()` ä¸­

**ä½¿ç”¨åœºæ™¯**ï¼š
1. **æ²»ç†**ï¼šä¸´æ—¶ç¦ç”¨æœ‰é£é™©çš„æŠ€èƒ½
2. **A/B æµ‹è¯•**ï¼šæ¯”è¾ƒä¸åŒçš„æŠ€èƒ½é…ç½®
3. **å›æ»š**ï¼šç¦ç”¨æ–°æ·»åŠ çš„æŠ€èƒ½è€Œä¸åˆ é™¤
4. **å®¡è®¡**ï¼šåœ¨ explain è¾“å‡ºä¸­æŸ¥çœ‹ç¦ç”¨çš„æŠ€èƒ½

**CLI å‘½ä»¤**ï¼š
```bash
# ç¦ç”¨æŠ€èƒ½
yuangs skills disable risky-operation

# åˆ—å‡ºä»¥éªŒè¯
yuangs skills list

# å¦‚æœéœ€è¦ï¼Œé‡æ–°å¯ç”¨
yuangs skills enable risky-operation
```

---

## ğŸ§ª æµ‹è¯•ä¸ Snapshots

### åˆ›å»º Explain Snapshots

```bash
# åˆ›å»ºæœ€è¿‘ä¸€æ¬¡æ‰§è¡Œçš„ snapshot
yuangs replay exec_1768820380225_rgts34981 --explain --dry > snapshot.txt
```

Snapshots å¯ç”¨äºï¼š
- âœ… å›å½’æµ‹è¯•
- âœ… è¾“å‡ºæ ¼å¼éªŒè¯
- âœ… æ–‡æ¡£ç¤ºä¾‹
- âœ… å®¡è®¡çº¿ç´¢

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯ Aï¼šæ™ºèƒ½è°ƒè¯•

```bash
@!build.sh
# ç³»ç»Ÿè¿”å›æŠ¥é”™â€¦

ä¸Šé¢çš„é”™è¯¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ
```

AI å°†ç»“åˆ **build.sh å†…å®¹ + å®é™…è¾“å‡º** è¿›è¡Œåˆ†æã€‚

---

### åœºæ™¯ Bï¼šå‘½ä»¤ç”Ÿæˆ

```bash
ai -e "æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹å¤§äº 100M çš„æ–‡ä»¶"
```

AI ç”Ÿæˆå»ºè®®å‘½ä»¤ï¼ˆå¦‚ `find . -type f -size +100M`ï¼‰ï¼Œ
**å­˜å…¥å‰ªè´´æ¿ï¼Œç­‰å¾…ä½ ç¡®è®¤æ‰§è¡Œã€‚**

---

### åœºæ™¯ Cï¼šé¡¹ç›®å®¡è®¡

```bash
#src/
åˆ†æè¿™äº›æ¨¡å—çš„åŠŸèƒ½
```

AI åœ¨**æ˜¾å¼æˆæƒ**ä¸‹è¯»å–ç›®å½•å†…å®¹å¹¶ç”Ÿæˆç»“æ„åˆ†æã€‚

---

## ğŸ“ å®ç°è¯´æ˜

### Explain Output v1

**æ–‡ä»¶**ï¼š`src/core/explain.ts`

**å…³é”®è®¾è®¡**ï¼š
- çº¯å‡½æ•°ï¼ˆæ— å‰¯ä½œç”¨ï¼‰
- æ— å…¨å±€çŠ¶æ€çš„å¤–éƒ¨ä¾èµ–
- ä½¿ç”¨ç°æœ‰çš„ `ExecutionRecord` ç»“æ„
- ç¨³å®šæ ¼å¼ï¼ˆç‰ˆæœ¬åŒ–ï¼‰

---

### Replay Diff

**æ–‡ä»¶**ï¼š`src/core/replayDiff.ts`

**å…³é”®è®¾è®¡**ï¼š
- æ¯”è¾ƒ Decisionã€Model å’Œ Skills å±‚
- æ˜¾ç¤º added/removed/changed æŠ€èƒ½
- è¯­ä¹‰ diffï¼ˆé token çº§åˆ«ï¼‰
- ä¸ Explain v1 æ ¼å¼å…¼å®¹

---

### Skills Control

**æ–‡ä»¶**ï¼š`src/agent/skills.ts`

**å…³é”®å˜æ›´**ï¼š
- å‘ `Skill` æ¥å£æ·»åŠ  `enabled: boolean` å­—æ®µ
- å¯¼å‡º `computeSkillScore()` ä¾› CLI ä½¿ç”¨
- `getRelevantSkills()` è¿‡æ»¤ç¦ç”¨çš„æŠ€èƒ½

---

## ğŸ“¦ å®‰è£…ä¸é…ç½®

```bash
npm install -g yuangs
```

å¸¸ç”¨é…ç½®ï¼š

```bash
yuangs config defaultModel Assistant
yuangs config accountType pro
```

---

## ğŸ—“ï¸ è¿‘æœŸæ›´æ–°ï¼ˆChangelogï¼‰

- **v2.40.0** (2026â€‘01â€‘20)
  - **Governance Refactor**: å®ç°ä¸‰é˜¶æ®µæ‰§è¡Œæ¨¡å‹ï¼ˆPre-Exec éªŒè¯ -> Exec æäº¤ -> Post-Exec æŠ¥å‘Šï¼‰
  - **è¯­ä¹‰çº§äº‹å®æº**: ç¡®ä¿ `Git Result` ä¸ `Snapshot Verification` ç‰©ç†åˆ†åŒºï¼Œæ¶ˆé™¤è¯­ä¹‰æ­§ä¹‰
  - **é²æ£’æ€§ä¿®å¤**: ä¿®å¤äº† Git ç»Ÿè®¡è§£æåŠæš‚å­˜åŒºå˜æ›´æ£€æµ‹å¤±æ•ˆçš„ Bug
- **v2.29.0** (2026â€‘01â€‘20)
  - æ–°å¢ Explainability åŠŸèƒ½ï¼ˆ`explain` å‘½ä»¤ï¼‰
  - æ–°å¢ Replay++ æ”¯æŒï¼ˆ`--dry`, `--explain`, `--diff`ï¼‰
  - æ–°å¢ Skills ç®¡ç†å‘½ä»¤ï¼ˆ`skills list/explain/disable/enable`ï¼‰
  - å¼•å…¥ Explain Output Spec v1 è§„èŒƒ
  - å®ç° Replay Diff åŠŸèƒ½
- **v2.11.0** (2026â€‘01â€‘18)
  - æ–°å¢ 40+ Shell å†…ç½®å‘½ä»¤æ”¯æŒï¼ˆcd, pwd, ls, git ç­‰ï¼‰
- **v2.10.0** (2026â€‘01â€‘18)
  - å¼•å…¥ Shell äº¤äº’å†…æ ¸ã€Ghost Text ä¸æ’ä»¶ç³»ç»Ÿ
- **v1.3.67** (2026â€‘01â€‘17)
  - æ–°å¢ `@` æ–‡ä»¶é€‰æ‹©ä¸ `#` ç›®å½•è¯»å–åŠŸèƒ½

---

## âœ… Phase 2 å®Œæˆæ¸…å•

æ‰€æœ‰ Phase 2 ç›®æ ‡å·²å®Œæˆï¼š

- [x] Explainabilityï¼ˆExecutionRecord çº§åˆ«ï¼‰
- [x] Replay dry / explain / strict
- [x] Skill scoring & enable æ ‡å¿—
- [x] æ‰€æœ‰ä¸‰ä¸ªåŠŸèƒ½çš„ CLI é›†æˆ
- [x] Replay diff å®ç°
- [x] Skills enabled è¿‡æ»¤
- [x] Explain v1 è§„èŒƒ
- [x] Snapshot æµ‹è¯•èƒ½åŠ›

**ä¸‹ä¸€é˜¶æ®µ**ï¼šPhase 3 - é«˜çº§æ²»ç†ä¸é¡¹ç›®çº§æ™ºèƒ½

---

## ğŸ“š æ›´å¤šä¿¡æ¯

- **è®¾è®¡åŸç†**: [docs/implementation_principles.md](docs/implementation_principles.md)
- **åœºæ™¯ç¤ºä¾‹**: [docs/scenarios.md](docs/scenarios.md)
- **æ‰§è¡Œè¯­ä¹‰**: [docs/semantics.md](docs/semantics.md)
- **éç›®æ ‡**: [docs/non-goals.md](docs/non-goals.md)
- **å¨èƒæ¨¡å‹**: [docs/threat_model.md](docs/threat_model.md)
- **å˜æ›´æ—¥å¿—**: [docs/CHANGELOG.md](docs/CHANGELOG.md)
- **Shell è¡¥å…¨**: [docs/tab_completion_guide.md](docs/tab_completion_guide.md)
- **ä¸Šä¸‹æ–‡ä¼˜åŒ–**: [docs/context_optimization_analysis.md](docs/context_optimization_analysis.md)
- **ä»£ç†ç®¡é“**: [docs/AGENT_PIPELINE.md](docs/AGENT_PIPELINE.md)
- **ä¸Šä¸‹æ–‡ç®¡ç†**: [docs/context_management.md](docs/context_management.md)

---

## âš–ï¸ ç»´æŠ¤è€…

**@yuanguangshan**

> **AI æä¾›æ€è·¯ï¼Œäººç±»æŒæ§æ‰§è¡Œã€‚**
> è¿™ä¸æ˜¯å¦¥åï¼Œè€Œæ˜¯å¯¹å·¥ç¨‹ç†æ€§çš„å°Šé‡ã€‚

---

## çŠ¶æ€

`yuangs` æ­£åœ¨ç§¯ææ¼”è¿›ä¸­ã€‚
æ ¸å¿ƒæ²»ç†æ¨¡å‹å·²ç¨³å®šï¼›æ¥å£ä»åœ¨ä¼˜åŒ–ä¸­ã€‚

æ¬¢è¿è´¡çŒ®ã€æƒ³æ³•å’Œæœ‰åŸåˆ™çš„æ‰¹è¯„ã€‚

> **"AI é™¤éè¢«æ˜ç¡®è¦æ±‚ï¼Œå¦åˆ™ä¸åº”è¯¥æ¯”è¾“å…¥çœ‹èµ·æ¥æ›´èªæ˜ã€‚"**

---

## ğŸ” Code Change Governance System

The governance system provides safe, auditable code changes with human oversight. All features follow constitutional principles and have been fully verified.

### Key Features

- âœ… **Three-Phase Model**: ç‰©ç†åˆ†åŒº Pre-Exec (éªŒè¯), Exec (æäº¤), Post-Exec (å®¡è®¡)
- âœ… **Proposal-First**: All changes start as proposals, no execution without review
- âœ… **Human-in-the-Loop**: Explicit approval with diff preview and risk assessment
- âœ… **Snapshot Safety**: Automatic rollback on failure
- âœ… **Strict Truth Sources**: æ˜ç¡®åŒºåˆ† Patch Truth, Snapshot Truth ä¸ Git Truth
- âœ… **Audit Trail**: Complete lifecycle tracking for every action

### Demo Summary

| Demo # | Feature | Status |
--------|---------|--------|
| 1 | Diff creation | âœ… Working |
| 2 | Proposal | âœ… Working |
| 3 | List actions | âœ… Working |
| 4 | Approval with review | âœ… Working |
| 5 | Execution with snapshot | âœ… Working |
| 6 | Failure and rollback | âœ… Working |
| 7 | Action status | âœ… Working |
| 8 | Full workflow | âœ… Working |
| 9 | State invariants | âœ… Working |
| 10 | Capability tokens | âœ… Working |
| 11 | Crash recovery | âœ… Working |
| 12 | Persistence audit | âœ… Working |
| 13 | Risk assessment | âœ… Working |

### Quick Start

```bash
# Propose a code change
yuangs diff-edit propose /path/to/patch.patch --rationale "Your rationale"

# List pending actions
yuangs diff-edit list

# Review and approve
yuangs diff-edit approve <action-id>

# Execute with safety
yuangs diff-edit exec <action-id>
```

### Documentation

- ğŸ“– **Complete Demo Guide**: [DEMO.md](DEMO.md) - Detailed runnable examples for all features
- âœ… **Verification Report**: [VERIFICATION_REPORT.md](VERIFICATION_REPORT.md) - Implementation status confirmation

### Available Commands

```bash
yuangs diff-edit propose <file>     # Submit a diff for review
yuangs diff-edit list               # View all actions
yuangs diff-edit approve <id>       # Review and approve
yuangs diff-edit exec <id>          # Execute approved action
yuangs diff-edit status <id>        # Check action status
```

---

*æ­¤å†…å®¹ç”±æ’ä»¶è‡ªä¸»æ›´æ–°*

diff-editä½¿æœ¬é¡¹ç›®æœ‰äº†è´¨çš„å˜åŒ–ã€‚^-^

