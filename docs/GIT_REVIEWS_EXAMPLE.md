# Git Reviews 文档示例

本文档展示了 `yuangs git review` 命令自动生成的 `git_reviews.md` 文件的格式。

## 生成的文档格式

每次运行 `yuangs git review` 时，审查结果会自动追加到项目根目录的 `git_reviews.md` 文件中。

### 示例：完整的 git_reviews.md 内容

```markdown
> 📝 Git Code Review History
> Generated by Yuangs CLI

---

## 📋 Code Review - 2026/1/28 19:00:00

**📊 评分:** 🌟 92/100  
**🔧 级别:** STANDARD  
**🌿 分支:** `main`  
**💾 提交:** `a1b2c3d`  
**📂 范围:** 暂存区 (5 个文件)  

### 📝 总体评价

代码质量优秀，结构清晰，遵循最佳实践。发现几个小的改进点，但整体无需重大修改。

### ⚠️ 发现的问题 (3)

#### 1. [WARNING] src/utils/helper.ts:42

该函数缺少错误处理，可能导致未捕获的异常。

**💡 建议:** 添加 try-catch 块或返回 Promise 的错误处理

<details>
<summary>代码片段</summary>

```
export function parseData(input: string) {
  return JSON.parse(input);
}
```

</details>

#### 2. [INFO] src/components/Button.tsx:15

建议为 Button 组件添加 PropTypes 或 TypeScript 类型定义。

#### 3. [INFO] src/api/client.ts:28

可以考虑添加请求超时配置。

### 👍 优点

- ✅ 代码结构清晰，模块化良好
- ✅ 命名规范，易于理解
- ✅ 适当的注释和文档
- ✅ 遵循项目编码规范

### 💡 建议

- 添加单元测试覆盖率
- 考虑提取公共逻辑到 utils
- 建议使用 TypeScript 严格模式

[↑ 返回顶部](#)

---

## 📋 Code Review - 2026/1/28 19:30:00

**📊 评分:** 👍 78/100  
**🔧 级别:** QUICK  
**🌿 分支:** `feature/auth`  
**💾 提交:** `e4f5g6h`  
**📂 范围:** 暂存区 (2 个文件)  

### 📝 总体评价

基础功能实现完成，但需要改进错误处理和边界条件检查。

### ⚠️ 发现的问题 (2)

#### 1. [ERROR] src/auth/login.ts:50

潜在的空指针错误：未检查 user 对象是否存在就访问其属性。

**💡 建议:** 添加空值检查 `if (!user) return;`

<details>
<summary>代码片段</summary>

```
async function login(email: string, password: string) {
  const user = await findUser(email);
  const isValid = await bcrypt.compare(password, user.password);
  return isValid;
}
```

</details>

#### 2. [WARNING] src/auth/validator.ts:12

正则表达式未转义特殊字符，可能导致匹配错误。

### 👍 优点

- ✅ 登录逻辑清晰
- ✅ 使用了 bcrypt 加密密码
- ✅ 基本的输入验证

### 💡 建议

- 改进错误处理和用户反馈
- 添加日志记录
- 建议编写集成测试

[↑ 返回顶部](#)
```

## 命令行选项

```bash
# 基本审查（默认保存到 git_reviews.md）
yuangs git review

# 指定审查级别
yuangs git review --level quick
yuangs git review --level standard
yuangs git review --level deep

# 审查未暂存的变更
yuangs git review --unstaged

# 审查特定文件
yuangs git review --file src/utils/helper.ts

# 不保存审查结果（仅显示）
yuangs git review --no-save

# 禁用 AI（仅显示变更摘要）
yuangs git review --no-ai
```

## 文档结构说明

每次审查记录包含以下部分：

1. **元数据**
   - 时间戳
   - 评分（带表情符号）
   - 审查级别
   - 分支名称
   - Git 提交 hash
   - 审查范围（暂存区/未暂存）

2. **总体评价**
   - AI 生成的代码质量总结

3. **发现的问题**
   - 按严重程度排序（CRITICAL > ERROR > WARNING > INFO）
   - 包含文件路径和行号
   - 问题描述
   - 修复建议
   - 可展开的代码片段（如果有）

4. **优点**
   - 代码的优点列表

5. **建议**
   - 改进建议列表

6. **快速导航**
   - 返回顶部的链接

## 使用场景

### 1. 持续集成
在 CI/CD 流程中自动运行代码审查，将结果保存到文档中供团队查看。

```yaml
# .github/workflows/review.yml
name: Code Review
on: [push, pull_request]
jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npx yuangs git review
      - uses: actions/upload-artifact@v2
        with:
          name: review-results
          path: git_reviews.md
```

### 2. 代码审查历史追踪
团队成员可以查看 `git_reviews.md` 了解代码质量的演进历史，识别反复出现的问题。

### 3. Pull Request 参考
在创建 Pull Request 时，可以附上 `git_reviews.md` 中的相关审查结果作为参考。

### 4. 代码质量报告
定期（每周/每月）汇总 `git_reviews.md` 中的数据，生成代码质量趋势报告。

## 注意事项

1. **自动追加**：新的审查结果会自动追加到文件末尾，不会覆盖之前的内容。

2. **文件大小**：长期使用后，`git_reviews.md` 可能会变得很大。建议定期清理旧记录或归档。

3. **Git 跟踪**：建议将 `git_reviews.md` 添加到 `.gitignore`，避免提交敏感的审查信息，或者定期清理后提交。

```bash
# .gitignore
git_reviews.md
```

4. **多分支开发**：不同分支的审查会记录在同一个文件中，通过分支名称可以区分。

## 最佳实践

1. **定期审查**：在提交代码前运行 `yuangs git review`，确保代码质量。

2. **结合 Git Hooks**：使用 pre-commit hook 自动运行审查。

```bash
# .git/hooks/pre-commit
#!/bin/bash
npx yuangs git review --level quick || exit 1
```

3. **团队共享**：如果团队希望共享审查历史，可以将 `git_reviews.md` 提交到仓库，但要注意清理敏感信息。

4. **定期归档**：每月将 `git_reviews.md` 归档到 `reviews/2026-01.md`，保持文件大小合理。

## 故障排查

### 问题：保存失败

如果看到 "⚠️ 保存审查结果失败" 警告：
- 检查文件权限
- 确保磁盘空间充足
- 查看完整的错误信息

### 问题：文件不存在

第一次运行时会自动创建 `git_reviews.md`。如果文件被删除，下次审查会重新创建。

### 问题：不想保存

使用 `--no-save` 选项仅显示审查结果，不保存到文件。

```bash
yuangs git review --no-save
```

## 未来改进

可能的增强功能：

1. 支持导出为 JSON 格式
2. 支持按日期/评分/分支筛选
3. 生成趋势图表
4. 集成到 GitHub/GitLab PR 评论
5. 支持自定义输出模板
