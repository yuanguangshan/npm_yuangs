# Agent Pipeline å®ç°æ€»ç»“

## ç‰ˆæœ¬ 2.1.0 - å·²å®ŒæˆåŠŸèƒ½

### âœ… æ ¸å¿ƒæ¶æ„å®ç°

#### 1. Agent Pipeline æ ¸å¿ƒ (100%)

å·²å®Œæˆçš„æ¨¡å—ï¼š

- âœ… `AgentPipeline.ts` - æ ¸å¿ƒç¼–æ’å™¨ï¼Œåè°ƒæ‰€æœ‰é˜¶æ®µ
- âœ… `types.ts` - å®Œæ•´çš„ç±»å‹ç³»ç»Ÿå®šä¹‰
- âœ… `intent.ts` - æ„å›¾åˆ†æï¼Œé›†æˆç°æœ‰ Capability System
- âœ… `context.ts` - ä¸Šä¸‹æ–‡ç»„è£…ï¼Œæ”¯æŒæ–‡ä»¶ã€Git diffã€å†å²
- âœ… `prompt.ts` - ç»Ÿä¸€çš„æç¤ºè¯æ„å»ºï¼ˆChat + Commandï¼‰
- âœ… `selectModel.ts` - åŸºäºèƒ½åŠ›çš„æ™ºèƒ½æ¨¡å‹é€‰æ‹©
- âœ… `llm.ts` - ç»Ÿä¸€çš„ LLM æ‰§è¡Œï¼ˆæµå¼ + éæµå¼ï¼‰
- âœ… `interpret.ts` - ç»“æœè§£é‡Šä¸ºå¯æ‰§è¡ŒåŠ¨ä½œ
- âœ… `actions.ts` - åŠ¨ä½œæ‰§è¡Œï¼ˆprint / confirm / executeï¼‰
- âœ… `record.ts` - æ‰§è¡Œè®°å½•ç³»ç»Ÿ
- âœ… `replay.ts` - æ‰§è¡Œé‡æ”¾åŠŸèƒ½

#### 2. ç»Ÿä¸€çš„æ‰§è¡Œæµç¨‹

```
User Input â†’ Intent â†’ Context â†’ Prompt â†’ Model â†’ LLM â†’ Interpret â†’ Action â†’ Record
```

æ‰€æœ‰é˜¶æ®µéƒ½å·²å®ç°å¹¶å¯æ­£å¸¸å·¥ä½œã€‚

#### 3. ä¸‰ç§è¿è¡Œæ¨¡å¼

- âœ… `chat` - AI èŠå¤©æ¨¡å¼ï¼ˆæµå¼è¾“å‡ºï¼‰
- âœ… `command` - ç”Ÿæˆå‘½ä»¤ï¼ˆéœ€ç¡®è®¤ï¼‰
- âœ… `command+exec` - ç”Ÿæˆå¹¶æ‰§è¡Œ

### âœ… æ ¸å¿ƒç‰¹æ€§

#### æ‰§è¡Œè®°å½•ä¸é‡æ”¾

- âœ… è‡ªåŠ¨ä¿å­˜æ¯æ¬¡æ‰§è¡Œçš„å®Œæ•´è®°å½•
- âœ… åŒ…å«ï¼šè¾“å…¥ã€æç¤ºè¯ã€æ¨¡å‹ã€ç»“æœã€åŠ¨ä½œ
- âœ… æ”¯æŒé€šè¿‡ ID æŸ¥è¯¢å’Œé‡æ”¾
- âœ… å†…å­˜ç®¡ç†ï¼ˆä¿ç•™æœ€è¿‘ 100 æ¡ï¼‰

#### å¯è§‚æµ‹æ€§

- âœ… Verbose æ¨¡å¼æ˜¾ç¤ºè¯¦ç»†æ‰§è¡Œä¿¡æ¯
- âœ… æ‰§è¡Œ ID è¿½è¸ª
- âœ… æ¨¡å‹é€‰æ‹©æ—¥å¿—
- âœ… å»¶è¿Ÿç»Ÿè®¡
- âœ… Token ä½¿ç”¨ç»Ÿè®¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰

#### èƒ½åŠ›ç³»ç»Ÿé›†æˆ

- âœ… å¤ç”¨ç°æœ‰çš„ `inferCapabilityRequirement`
- âœ… å¤ç”¨ç°æœ‰çš„ `AtomicCapability` æšä¸¾
- âœ… è‡ªåŠ¨æ ¹æ®èƒ½åŠ›é€‰æ‹©æ¨¡å‹
- âœ… Chat æ¨¡å¼ä¹Ÿæ”¯æŒèƒ½åŠ›åŒ¹é…

### âœ… å…¼å®¹æ€§

- âœ… å®Œå…¨å‘åå…¼å®¹ç°æœ‰ CLI å‘½ä»¤
- âœ… ä¸ç ´åç°æœ‰çš„ `handleAICommand`
- âœ… ä¸ç ´åç°æœ‰çš„ `handleAIChat`
- âœ… å¤ç”¨æ‰€æœ‰ç°æœ‰åŸºç¡€è®¾æ–½

### âœ… æ–‡æ¡£

- âœ… `AGENT_PIPELINE.md` - å®Œæ•´æ¶æ„æ–‡æ¡£
- âœ… ä½¿ç”¨ç¤ºä¾‹
- âœ… æ‰©å±•æŒ‡å—
- âœ… è¿ç§»æŒ‡å—

### âœ… æµ‹è¯•

- âœ… `test_agent_pipeline.js` - åŸºç¡€åŠŸèƒ½æµ‹è¯•
- âœ… ç¼–è¯‘é€šè¿‡ï¼ˆTypeScriptï¼‰
- âœ… æ—  lint é”™è¯¯

## ğŸ“‹ å¾…å®ç°åŠŸèƒ½ï¼ˆæ¥è‡ª todo.mdï¼‰

### ç¬¬ä¸€ä¼˜å…ˆçº§

#### 1. Planner / Tool Callingï¼ˆå¤šæ­¥ Agentï¼‰

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/planner/
â”œâ”€â”€ types.ts          # PlanStep, AgentPlan ç±»å‹
â”œâ”€â”€ prompt.ts         # Planner ä¸“ç”¨æç¤ºè¯
â”œâ”€â”€ index.ts          # plan() å‡½æ•°
â””â”€â”€ executor.ts       # executeStep() å‡½æ•°
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- LLM ç”Ÿæˆå¤šæ­¥è®¡åˆ’
- æ¯æ­¥å¯ä»¥æ˜¯ tool / shell / ask
- Pipeline è´Ÿè´£è°ƒåº¦æ‰§è¡Œ

#### 2. Tool Registryï¼ˆçœŸæ­£çš„ Function Callingï¼‰

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/tools/
â”œâ”€â”€ types.ts          # Tool æ¥å£å®šä¹‰
â”œâ”€â”€ registry.ts       # registerTool, getTool, listTools
â””â”€â”€ builtins/         # å†…ç½®å·¥å…·
    â”œâ”€â”€ shell.ts      # shell.run
    â”œâ”€â”€ file.ts       # file.read, file.write
    â””â”€â”€ web.ts        # web.fetch
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- Tool æ˜¯ä¸€ç­‰å…¬æ°‘
- LLM åªèƒ½é€‰æ‹©å·¥å…·ï¼Œä¸èƒ½ç›´æ¥æ‰§è¡Œ
- æ‰€æœ‰å·¥å…·å¯è¢« Planner è°ƒç”¨

#### 3. Agent Memoryï¼ˆé•¿æœŸè®°å¿†ï¼‰

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/memory/
â”œâ”€â”€ types.ts          # MemoryItem ç±»å‹
â”œâ”€â”€ store.ts          # saveMemory, searchMemory
â”œâ”€â”€ summarize.ts      # è‡ªåŠ¨æ€»ç»“
â””â”€â”€ embedding.ts      # å‘é‡åŒ–ï¼ˆå¯é€‰ï¼‰
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- è‡ªåŠ¨æ€»ç»“æˆåŠŸçš„æ‰§è¡Œ
- å­˜å‚¨ä¸ºå¯æ£€ç´¢çš„è®°å¿†
- Prompt æ³¨å…¥ç›¸å…³è®°å¿†

### ç¬¬äºŒä¼˜å…ˆçº§

#### 4. Self-reflection / Critic

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/critic/
â”œâ”€â”€ types.ts          # CritiqueResult ç±»å‹
â”œâ”€â”€ prompt.ts         # Critic æç¤ºè¯
â””â”€â”€ index.ts          # critique() å‡½æ•°
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- æ‰§è¡Œåè‡ªåŠ¨è¯„ä¼°
- åˆ¤æ–­æˆåŠŸ/å¤±è´¥/éœ€é‡è¯•
- ä¸ºè‡ªåŠ¨ä¿®å¤æä¾›ä¾æ®

#### 5. Auto-retry / Self-heal

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/retry/
â”œâ”€â”€ types.ts          # RetryContext ç±»å‹
â”œâ”€â”€ repairPrompt.ts   # ä¿®å¤æç¤ºè¯
â””â”€â”€ index.ts          # runWithRetry() å‡½æ•°
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- å¤±è´¥åè‡ªåŠ¨åæ€
- ç”Ÿæˆä¿®å¤è®¡åˆ’
- æœ‰é™æ¬¡æ•°é‡è¯•

#### 6. Multi-Agentï¼ˆåˆ†ä½“æ¶æ„ï¼‰

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/core/
â”œâ”€â”€ Agent.ts          # Agent æ¥å£
â”œâ”€â”€ PlannerAgent.ts   # è§„åˆ’ Agent
â”œâ”€â”€ ExecutorAgent.ts  # æ‰§è¡Œ Agent
â”œâ”€â”€ CriticAgent.ts    # è¯„ä¼° Agent
â””â”€â”€ Orchestrator.ts   # ç¼–æ’å™¨
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- Planner / Executor / Critic åˆ†ç¦»
- æ¯ä¸ª Agent å¯ç‹¬ç«‹é…ç½®æ¨¡å‹
- æ”¯æŒå¹¶è¡Œ/æŠ•ç¥¨

### ç¬¬ä¸‰ä¼˜å…ˆçº§

#### 7. Timeline å¯è§†åŒ–

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/timeline/
â”œâ”€â”€ types.ts          # TimelineEvent ç±»å‹
â”œâ”€â”€ collector.ts      # emit(), getTimeline()
â””â”€â”€ export.ts         # å¯¼å‡ºä¸º JSON
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- è®°å½•æ¯ä¸ªé˜¶æ®µçš„äº‹ä»¶
- å¯¼å‡ºä¸ºå‰ç«¯å‹å¥½çš„ JSON
- æ”¯æŒ Replay å’Œ Diff

#### 8. æˆæœ¬ / Token å¯è§†åŒ–

**å·²éƒ¨åˆ†å®ç°ï¼Œéœ€å¢å¼ºï¼š**
- âœ… LLMResult å·²åŒ…å« tokens å’Œ costUsd å­—æ®µ
- â³ éœ€è¦å®ç° `estimateCost()` å‡½æ•°
- â³ éœ€è¦å®ç°ç´¯è®¡ç»Ÿè®¡

#### 9. é£é™©ç­–ç•¥å¢å¼º

**éœ€è¦å®ç°çš„æ¨¡å—ï¼š**

```
src/agent/risk/
â”œâ”€â”€ policy.ts         # requiresExtraConfirmation()
â””â”€â”€ rules.ts          # é£é™©è§„åˆ™é…ç½®
```

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- é«˜é£é™©å‘½ä»¤å¼ºåˆ¶äºŒæ¬¡ç¡®è®¤
- å¯é…ç½®çš„é£é™©è§„åˆ™
- rm -rf / sudo ç­‰ç‰¹æ®Šå¤„ç†

## ğŸ¯ å®ç°è·¯çº¿å›¾

### Phase 1: åŸºç¡€å¢å¼ºï¼ˆ1-2 å‘¨ï¼‰
- [ ] Tool Registry
- [ ] Planner / Tool Calling
- [ ] Agent Memory (åŸºç¡€ç‰ˆ)

### Phase 2: æ™ºèƒ½å¢å¼ºï¼ˆ2-3 å‘¨ï¼‰
- [ ] Self-reflection / Critic
- [ ] Auto-retry / Self-heal
- [ ] é£é™©ç­–ç•¥å¢å¼º

### Phase 3: æ¶æ„è¿›åŒ–ï¼ˆ3-4 å‘¨ï¼‰
- [ ] Multi-Agent åˆ†ä½“
- [ ] Timeline å¯è§†åŒ–
- [ ] Memory Embedding + Vector Search

### Phase 4: äº§å“åŒ–ï¼ˆæ—¶é—´å¾…å®šï¼‰
- [ ] Web UI
- [ ] Agent Debug Studio
- [ ] å®Œæ•´çš„ SDK æ–‡æ¡£

## ğŸ“Š å½“å‰è¿›åº¦

```
æ ¸å¿ƒæ¶æ„:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
åŸºç¡€åŠŸèƒ½:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%
é«˜çº§åŠŸèƒ½:        â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  20%
äº§å“åŒ–:          â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘   0%
```

## ğŸš€ å¦‚ä½•ç»§ç»­

1. **æµ‹è¯•å½“å‰å®ç°**
   ```bash
   node test_agent_pipeline.js
   ```

2. **æŸ¥çœ‹æ–‡æ¡£**
   ```bash
   cat AGENT_PIPELINE.md
   ```

3. **å¼€å§‹å®ç°ä¸‹ä¸€ä¸ªåŠŸèƒ½**
   - å»ºè®®ä» Tool Registry å¼€å§‹
   - å‚è€ƒ todo.md ä¸­çš„ä»£ç éª¨æ¶
   - ä¿æŒä¸ç°æœ‰æ¶æ„çš„ä¸€è‡´æ€§

## ğŸ’¡ è®¾è®¡åŸåˆ™

åœ¨å®ç°åç»­åŠŸèƒ½æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **æœ€å°ä¾µå…¥** - ä¸ç ´åç°æœ‰åŠŸèƒ½
2. **æ¸è¿›å¢å¼º** - åŠŸèƒ½å¯ç‹¬ç«‹å¯ç”¨/ç¦ç”¨
3. **ç±»å‹å®‰å…¨** - å……åˆ†åˆ©ç”¨ TypeScript
4. **å¯æµ‹è¯•** - æ¯ä¸ªæ¨¡å—éƒ½åº”è¯¥å¯æµ‹è¯•
5. **å¯è§‚æµ‹** - è®°å½•å…³é”®æ‰§è¡Œä¿¡æ¯
6. **å¯æ‰©å±•** - é¢„ç•™æ‰©å±•ç‚¹

## ğŸ‰ æ€»ç»“

ç‰ˆæœ¬ 2.1.0 æˆåŠŸå®ç°äº† Agent Pipeline çš„æ ¸å¿ƒæ¶æ„ï¼Œä¸ºåç»­çš„é«˜çº§åŠŸèƒ½æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚

æ‰€æœ‰åŸºç¡€è®¾æ–½å·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹å®ç°æ›´é«˜çº§çš„ Agent èƒ½åŠ›ï¼
