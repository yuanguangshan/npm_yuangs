# 🤖 Yuangs Git Auto - AI 驱动的全自动开发工作流

## 概述

`yuangs git auto` 是一个革命性的功能，它将 `plan`、`exec`、`review` 三个命令串联成一个完整的 AI 开发闭环，实现从需求到代码的全流程自动化。

## 工作流程

```
┌─────────────────────────────────────────────────────────┐
│                    AI 开发闭环                            │
└─────────────────────────────────────────────────────────┘

  1️⃣ PLAN (规划)
     ↓
  📝 todo.md (任务清单)
     ↓
  2️⃣ EXEC (执行) ──→ 生成代码
     ↓
  3️⃣ REVIEW (审查) ──→ 评分 + 反馈
     ↓
  ✅ 通过 (≥85分) → 标记完成 → 下一个任务
  ❌ 不通过 (<85分) → 根据反馈重新生成 (最多重试2次)
```

## 快速开始

### 1. 生成任务清单

```bash
yuangs git plan "实现用户登录功能，支持邮箱和手机号登录"
```

这将生成一个 `todo.md` 文件，包含详细的任务分解。

### 2. 启动自动化工作流

```bash
yuangs git auto
```

系统将自动：
- 读取 `todo.md` 中的任务
- 逐个执行未完成的任务
- 对每个任务生成的代码进行审查
- 根据审查结果决定是否通过或重试
- 更新任务状态和进度

## 命令选项

```bash
yuangs git auto [options]

Options:
  --max-tasks <number>    最大执行任务数 (默认: 5)
  --model <model>         指定 AI 模型 (默认: Assistant)
  --min-score <score>     最低审查分数 (默认: 85)
  --skip-review           跳过代码审查
```

### 示例

```bash
# 执行最多 3 个任务，使用 Gemini 模型
yuangs git auto --max-tasks 3 --model gemini-2.5-flash-lite

# 降低审查标准到 80 分
yuangs git auto --min-score 80

# 跳过审查，快速生成代码
yuangs git auto --skip-review
```

## todo.md 格式

### 基本格式

```markdown
> 📅 Generated by Yuangs Git Plan at 2026-01-28 10:00:00
> 🎯 Context: 实现用户登录功能
> 📊 Progress: 2/5 tasks completed
> 🔄 Current Task: 3

## [目标]
- [x] 创建 User 模型 <!-- exec:done, review:92, attempts:1 -->
- [x] 实现登录 API <!-- exec:done, review:88, attempts:2 -->
- [ ] 添加单元测试 <!-- exec:in_progress, attempts:1 -->
- [ ] 编写 API 文档
- [ ] 部署到测试环境
```

### 状态说明

**任务状态：**
- `[ ]` - 未完成
- `[x]` - 已完成

**执行状态（exec）：**
- `pending` - 待执行
- `in_progress` - 执行中
- `done` - 已完成
- `failed` - 失败

**其他元数据：**
- `review:92` - 审查评分
- `attempts:2` - 尝试次数

## 工作流控制

### 暂停和继续

工作流会在以下情况自动暂停：
- 达到 `--max-tasks` 限制
- 任务重试次数超过 2 次
- 遇到严重错误

要继续执行，只需再次运行：
```bash
yuangs git auto
```

系统会自动从上次中断的地方继续。

### 手动干预

如果某个任务一直无法通过审查，你可以：

1. **手动修改代码**
2. **更新 todo.md**，将任务标记为完成：
   ```markdown
   - [x] 任务描述 <!-- exec:done, review:manual -->
   ```
3. **继续自动化流程**：
   ```bash
   yuangs git auto
   ```

## 最佳实践

### 1. 合理设置任务粒度

在 `plan` 阶段，确保任务足够具体：

✅ 好的任务：
- 创建 `UserService.ts` 并实现 `login()` 方法
- 在 `LoginForm.tsx` 中添加表单验证逻辑

❌ 过于宽泛的任务：
- 实现用户模块
- 完成前端页面

### 2. 渐进式执行

首次使用时，建议：
```bash
yuangs git auto --max-tasks 1
```

观察生成的代码质量后，再逐步增加任务数。

### 3. 定期 Review

虽然有自动审查，但建议定期手动检查：
```bash
git diff
yuangs git review --level deep
```

### 4. 版本控制

在启动 `auto` 之前，建议创建一个新分支：
```bash
git checkout -b feature/auto-implementation
yuangs git auto
```

## 故障排除

### 问题：任务一直无法通过审查

**解决方案：**
1. 查看审查反馈：`cat todo.md`
2. 降低审查标准：`yuangs git auto --min-score 75`
3. 手动修复后继续

### 问题：生成的代码不符合预期

**解决方案：**
1. 在 `todo.md` 中添加更详细的上下文
2. 使用更强大的模型：`yuangs git auto --model Assistant`

### 问题：执行中断

**解决方案：**
直接再次运行 `yuangs git auto`，系统会自动恢复。

## 进阶用法

### 与其他命令结合

```bash
# 完整的开发流程
yuangs git plan "新功能需求"
yuangs git auto --max-tasks 10
yuangs git review --level deep
yuangs git commit
git push
```

### 自定义工作流

如果需要更精细的控制，可以分步执行：

```bash
# 1. 规划
yuangs git plan "需求描述"

# 2. 手动执行特定任务
yuangs git exec --task 1

# 3. 审查
yuangs git review

# 4. 继续自动化
yuangs git auto --max-tasks 5
```

## 限制和注意事项

1. **代码质量**：AI 生成的代码需要人工审查
2. **复杂逻辑**：对于复杂的业务逻辑，建议人工实现
3. **安全性**：涉及安全的代码必须人工审查
4. **测试**：自动生成的测试可能不够全面

## 未来规划

- [ ] 支持自动 git commit
- [ ] 集成 CI/CD 流程
- [ ] 支持多人协作模式
- [ ] 添加代码质量趋势分析
- [ ] 支持自定义审查规则

## 反馈

如有问题或建议，欢迎提 Issue！
