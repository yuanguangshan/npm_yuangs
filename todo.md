> 📅 Generated by Yuangs Git Plan at 1/28/2026, 9:44:51 AM
> 🎯 Context: 实现一个简单的看板视图功能

# 📋 CLI 看板功能开发 TODO

## [目标]

- [ ] 提供 CLI 内部只读的看板视图功能
- [ ] 支持固定三列：Todo / Doing / Done
- [ ] 使用本地 JSON 作为唯一数据源
- [ ] 保持低侵入、可扩展架构，不引入 TUI 或编辑能力
- [ ] 明确第一阶段“简单”的功能边界，避免过度设计
- [ ] 满足审查对安全性、架构合理性、测试与文档可交付性的要求

---

## [文件变更]

- [ ] 新增 `src/commands/BoardCommand.ts`
- [ ] 新增 `src/board/BoardService.ts`
- [ ] 新增 `src/board/repository/BoardRepository.ts`
- [ ] 新增 `src/board/repository/JsonBoardRepository.ts`
- [ ] 新增 `src/board/renderer/BoardRenderer.ts`
- [ ] 新增 `src/board/types.ts`（Board / Column / Card / ViewModel）
- [ ] 新增 `~/.yuangs/board.json`（初始化后生成）
- [ ] 更新 `src/utils/config.ts`（复用配置路径与错误处理）
- [ ] 新增测试文件：
  - [ ] `tests/board/BoardService.test.ts`
  - [ ] `tests/board/JsonBoardRepository.test.ts`
  - [ ] `tests/board/BoardRenderer.test.ts`
- [ ] 更新 `README.md`（新增“📋 看板功能（实验性）”章节）

---

## [详细步骤]

### 一、命令层（Command Layer）

- [ ] 实现 `yuangs board`
- [ ] 实现 `yuangs board init`
- [ ] 无子命令时默认等价于 `list`
- [ ] 统一 exit code 规则：
  - [ ] 正常展示：0
  - [ ] 数据不存在：提示 init，exit 1
  - [ ] 参数错误：明确错误信息，exit 1
- [ ] `BoardCommand` 只负责参数解析与分发，不涉及 IO / 渲染

---

### 二、数据模型设计

- [ ] 定义 Board v1 数据结构：
  - [ ] `version`
  - [ ] `columns`（id / title / order）
  - [ ] `cards`（id / title / columnId）
- [ ] 使用 `columnId` 替代 status
- [ ] Card 使用本地唯一 ID（timestamp + prefix）
- [ ] 预留 version 字段以支持未来迁移

---

### 三、Repository 层（数据访问）

- [ ] 定义 `BoardRepository` 接口：
  - [ ] `load()`
  - [ ] `save(board)`
  - [ ] `exists()`
- [ ] 实现 `JsonBoardRepository`
  - [ ] 复用 `config.ts` 中的路径与错误处理
  - [ ] 数据优先级：
    1. `~/.yuangs/board.json`
    2. `~/.yuangs.json -> board`
- [ ] BoardService 不直接读写文件

---

### 四、Service 层（业务逻辑）

- [ ] 实现 Board 结构校验
- [ ] 实现 `init` 默认数据生成（三列）
- [ ] 实现卡片按 column 分组
- [ ] 并发策略：
  - [ ] `load → mutate → save` 串行
  - [ ] 写入前再次校验文件存在性
  - [ ] 不引入锁（CLI 单进程假设）

---

### 五、渲染层（View Layer）

- [ ] 实现 `BoardRenderer`
- [ ] 仅接收 ViewModel，不关心数据来源
- [ ] 使用 ASCII / 表格方式输出
- [ ] 技术选型：
  - [ ] 使用 `cli-table3` 或等价库
  - [ ] 设置最大列宽
  - [ ] 超长文本截断（…）
  - [ ] 窄终端自动换行
- [ ] Renderer 可被未来 TUI 完整替换

---

### 六、安全性处理

- [ ] 检查以下文件权限：
  - [ ] `~/.yuangs.json`
  - [ ] `~/.yuangs/board.json`
- [ ] 若权限 > 600：
  - [ ] 输出 warning
  - [ ] 不强制修改权限
- [ ] 行为与 API Key 安全策略保持一致

---

### 七、初始化行为

- [ ] 实现 `yuangs board init`
- [ ] 默认生成三列（Todo / Doing / Done）
- [ ] 提示用户：
  - [ ] 数据存储位置
  - [ ] 当前仅支持只读
- [ ] 不引入交互式自定义

---

### 八、错误与边界处理

- [ ] JSON 损坏：明确错误信息 + 文件路径
- [ ] 未知 `columnId`：fallback 到 `todo`
- [ ] 空看板：显示 Empty 状态
- [ ] 配置冲突：优先使用 `board.json`

---

### 九、测试计划

#### 单元测试（覆盖率 ≥ 80%）

- [ ] `BoardService`
  - [ ] load
  - [ ] init
  - [ ] validate
- [ ] `JsonBoardRepository`
  - [ ] 文件存在
  - [ ] 文件不存在
- [ ] `BoardRenderer`
  - [ ] 窄终端
  - [ ] 文本截断

#### 集成测试

- [ ] `yuangs board`（无数据）
- [ ] `yuangs board init`
- [ ] `yuangs board`（已有数据）

---

### 十、文档交付

- [ ] README 新增章节：📋 看板功能（实验性）
  - [ ] 功能说明（只读 / 单看板）
  - [ ] 快速开始
  - [ ] 数据存储位置
  - [ ] 明确限制
  - [ ] 未来规划（非承诺）

---

### 十一、历史提交对齐检查

- [ ] 对齐 `707db4f` / `d6aeea2`（默认 action / exit code）
- [ ] 对齐 `5b74426`（配置加载逻辑复用）
- [ ] 对齐 `6e29897`（命令注册方式一致）