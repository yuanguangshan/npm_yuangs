> 📅 Generated by Yuangs Git Plan at 1/28/2026, 10:07:55 AM
> 🎯 Context: 实现一个简单的加法计算器功能，支持两个数字相加
> 🔄 Current Task: 2
> 📊 Progress: 2/67 tasks completed

# ✅ TODO — 加法计算器功能开发

---

## [目标]

- [x] 实现一个安全、可预测、可扩展的 `add` 加法计算命令 <!-- exec:done -->
- [x] 与现有 `yuangs` CLI / agent / shell-ai 架构风格保持一致 <!-- exec:done -->
- [ ] 提供严格的输入校验与统一的错误处理机制
- [ ] 明确输出、返回值与可测试行为
- [ ] 为 i18n、dry-run、LLM / Agent 集成预留接口
- [ ] 不破坏现有架构、不引入过度设计

---

## [文件变更]

- [ ] 新增 `src/commands/add.ts`
  - 参数解析
  - 调用数字校验工具
  - 执行加法逻辑
  - 处理 `--dry-run`
  - 输出或返回结果

- [ ] 新增或增强 `src/utils/number.ts`
  - 提供统一的数字解析与校验函数 `parseNumber`

- [ ] 修改 `src/commands/index.ts`
  - 注册 `add` 命令
  - 保持现有命令注册风格与顺序

- [ ] （可选）新增或调整 `src/types/CommandResult.ts`
  - 明确命令返回结构（成功 / 失败）

- [ ] 更新 `README.md` / CLI Help
  - 添加 `add` 命令说明
  - 示例用法
  - `--dry-run` 行为说明

---

## [详细步骤]

### 一、命令接口设计

- [ ] 统一采用 Posix 风格命令：
  - `yuangs add <num1> <num2> [--dry-run]`
- [ ] 确认不引入 `--a / --b` 等参数形式
- [ ] 确保 CLI / LLM 双调用场景下接口清晰、稳定

---

### 二、输入校验与数字解析

- [ ] 参数数量必须严格等于 2
- [ ] 支持数值类型：
  - [ ] 整数（如 `1`, `-5`）
  - [ ] 浮点数（如 `3.14`, `-0.5`）
- [ ] 拒绝以下输入：
  - [ ] `NaN`
  - [ ] `Infinity`
  - [ ] 非法字符串
- [ ] 使用 `Number.isFinite` 进行校验
- [ ] （可选）限制最大安全范围（如 `Number.MAX_SAFE_INTEGER`）
- [ ] 所有数字解析统一通过 `parseNumber(input: string)`

---

### 三、错误处理机制

- [ ] 命令层不直接 `throw Error`
- [ ] 使用结构化 `CliError`
- [ ] 错误包含：
  - [ ] `code`
  - [ ] `messageKey`
  - [ ] `params`
- [ ] 错误统一由 CLI 框架：
  - [ ] 输出到 `stderr`
  - [ ] 设置非 0 exit code

---

### 四、国际化（i18n）前瞻设计

- [ ] 错误与提示信息不直接硬编码语言文本
- [ ] 使用 `messageKey + params` 形式
- [ ] 语言选择交由上层 CLI 决定
- [ ] 本阶段仅预留接口，不实现完整多语言系统

---

### 五、输出与返回策略

- [ ] CLI 正常执行时：
  - [ ] 结果输出到 `stdout`
- [ ] CLI 错误时：
  - [ ] 错误信息输出到 `stderr`
- [ ] 被其他模块调用时：
  - [ ] 返回 `number` 或结构化 `CommandResult`
- [ ] 示例行为确认：
  - `yuangs add 3 5` → 输出 `8`

---

### 六、`--dry-run` 行为实现

- [ ] 支持 `--dry-run` 参数
- [ ] 执行完整参数校验
- [ ] 不输出计算结果
- [ ] 返回 0 exit code
- [ ] 用于测试、agent 预演、LLM 调用链验证

---

### 七、安全与 LLM / Agent 前瞻

- [ ] 严格限制输入为数值类型
- [ ] 明确参数数量，避免 prompt 注入式滥用
- [ ] 保证计算复杂度为 O(1)
- [ ] 不引入资源放大或副作用行为

---

### 八、测试覆盖（最低要求）

- [ ] 正常路径测试：
  - [ ] `1 + 2`
  - [ ] `-1 + 0.5`
- [ ] 错误路径测试：
  - [ ] 参数不足
  - [ ] 参数过多
  - [ ] 非数字输入
  - [ ] `NaN` / `Infinity`
- [ ] 行为测试：
  - [ ] `--dry-run`

---

### 九、版本与发布

- [ ] 合并后提升 minor version（如 `5.x → 5.(x+1)`）
- [ ] README / CLI Help 与代码在同一 PR 更新
- [ ] 使用规范提交信息：
  - `feat(cli): add basic add command with validation and dry-run`

---